.. _cppLoggerPage:

Logger
######

The Logger plugin is a lightweight plugin that allows users to easily log all bytes received from a VectorNav unit to a binary file without the need to parse the packets.
This plugin can be used in conjunction with the Data Export plugin, which allows users to export the binary file that was logged into a *CSV*, *TXT*, or *RINEX* file. Information on how to export a binary file onced it has been logged with the Logger plugin can be found on the :ref:`cppDataExportPage` page.

Usage
=====
As demonstrated in the Simple Logger example, to use the Logger plugin, it is first necessary to create a :class:`~VN::Sensor` object and connect to the VectorNav unit, such as by using the :func:`~VN::Sensor::autoConnect` method.

.. literalinclude:: ../../examples/SimpleLogger/main.cpp
   :language: c++
   :start-at: Sensor sensor;
   :end-at: Error latestError = sensor.autoConnect(portName);
   :dedent: 4

Next, the resources required for data logging need to be set up. The :class:`~VN::Logger::SimpleLogger` object requires a :class:`~VN::ByteBuffer` object as well as the path of the desired log file. The :class:`~VN::ByteBuffer` object is a user-defined buffer where bytes will temporarily be stored before they are written to the log file.

.. literalinclude:: ../../examples/SimpleLogger/main.cpp
   :language: c++
   :start-at: ByteBuffer bufferToLog{1024 * 3};
   :end-at:  Logger::SimpleLogger logger{bufferToLog, filePath};
   :dedent: 4

.. warning::
    If the buffer overruns due to insufficient size, data will be missed. Ensure the buffer is appropriately sized based on the expected data throughput from the VectorNav unit to avoid losing any data while logging.

Once the :class:`~VN::ByteBuffer` and :class:`~VN::Logger::SimpleLogger` objects are instantiated, register the :class:`~VN::ByteBuffer` object with the :class:`~VN::Sensor` object as follows:

.. literalinclude:: ../../examples/SimpleLogger/main.cpp
   :language: c++
   :start-at: sensor.registerReceivedByteBuffer(&bufferToLog);
   :end-at:  sensor.registerReceivedByteBuffer(&bufferToLog);
   :dedent: 4

..  note::
    When using the SimpleLogger class, the logger must be started and stopped manually using the :func:`~VN::Logger::SimpleLogger::start` and :func:`~VN::Logger::SimpleLogger::stop` methods.

To create the log file and start logging data from the VectorNav unit, call the :func:`~VN::Logger::SimpleLogger::start` method. It it important to ensure that this call is successful, otherwise the logger was not able to create the file. 

.. literalinclude:: ../../examples/SimpleLogger/main.cpp
   :language: c++
   :start-at:  if (logger.start())
   :end-at:  std::cout << "Logging to " << filePath << std::endl;
   :dedent: 4

..  note::
    This call to start data logging spawns a separate thread dedicated to writing data to the file. This ensures that file write operations do not block the main thread, allowing it to continue processing efficiently.

While logging, the user should monitor for any asynchronous errors, such as buffer overruns, using the :func:`~VN::Sensor::getNextAsyncError` method. Any buffer overruns indicate that data has been dropped from the sensor during logging.

.. literalinclude:: ../../examples/SimpleLogger/main.cpp
   :language: cpp
   :start-at: asyncError
   :end-before: logger.stop()
   :dedent: 4

Stopping the logger is just as easy -- simply call the :func:`~VN::Logger::SimpleLogger::stop` method and deregister the :class:`~VN::ByteBuffer` object. 

.. literalinclude:: ../../examples/SimpleLogger/main.cpp
   :language: cpp
   :start-at: logger.stop();
   :end-at: sensor.deregisterReceivedByteBuffer();
   :dedent: 4

API
===

:ref:`Logger<namespace_VN__Logger>`
