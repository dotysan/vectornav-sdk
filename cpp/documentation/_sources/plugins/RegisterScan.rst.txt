.. _cppRegisterScanPage:

Register Scan
#############
The Register Scan plugin provides functionality to load a previously saved configuration file onto a VectorNav unit or to save the current configuration of a VectorNav unit into a configuration file. It can save any subset of configuration registers, and can optionally save only user-edited values. It contains prewritten methods to work with XML files (which are interoperable with Control Center) and ASCII files, or it can accept any runtime, user-defined format.

.. note::
    The Register Scan plugin makes use of abstract template interfaces, :class:`~VN::RegisterScan::ConfigReader` and :class:`~VN::RegisterScan::ConfigWriter`, to establish a consistent protocol for accessing and storing sensor configurations while supporting multiple file formats and custom implementation strategies.

Usage
=====
The VNSDK provides three different examples demonstrating use of the Register Scan plugin: Load Configuration, Save Configuration, and Save Non-Default Configuration. The Load Configuration example details how to upload a previously saved configuration file to a VectorNav unit. The Save Configuration example shows how to save all the configuration settings from the unit to a file. The Save Non-Default Configuration example walks through how to save only the registers that have been changed from the factory default settings to a file.

As demonstrated in each of the Register Scan examples, to use the Register Scan plugin it is first necessary to create a :class:`~VN::Sensor` object and connect to the VectorNav unit using the :func:`~VN::Sensor::autoConnect` method.


.. literalinclude:: ../../examples/RegisterScan/LoadConfiguration/main.cpp
   :language: c++
   :start-at: Sensor sensor;
   :end-at: Error latestError = sensor.autoConnect(portName);
   :dedent: 4

Loading a Configuration File
^^^^^^^^^^^^^^^^^^^^^^^^^^^^
To load a previously saved configuration file onto a VectorNav unit using the Register Scan plugin, a :class:`~VN::RegisterScan::ConfigReader` object that corresponds to the upload file type should be created. For example, to upload a previously saved XML configuration file to a VectorNav unit, an :class:`~VN::RegisterScan::XmlConfigReader` object should be created.

.. literalinclude:: ../../examples/RegisterScan/LoadConfiguration/main.cpp
   :language: c++
   :start-at: RegisterScan::XmlConfigReader configReader(filePath.string());
   :end-at: RegisterScan::XmlConfigReader configReader(filePath.string());
   :dedent: 8

Alternatively, to upload a previously saved text file of configuration settings onto a VectorNav unit, an :class:`~VN::RegisterScan::AsciiConfigReader` object should be created instead.

.. literalinclude:: ../../examples/RegisterScan/LoadConfiguration/main.cpp
   :language: c++
   :start-at: RegisterScan::AsciiConfigReader configReader(filePath.string());
   :end-at: RegisterScan::AsciiConfigReader configReader(filePath.string());
   :dedent: 8

The Register Scan plugin can also upload any user-defined configuration settings to the VectorNav unit. To do this, define the ASCII messages and create a :class:`~VN::RegisterScan::GenericConfigReader` object. For example:

.. literalinclude:: ../../examples/RegisterScan/LoadConfiguration/main.cpp
   :language: c++
   :start-at: uint16_t messageCount{0};
   :end-at: });
   :dedent: 8

Once the :class:`~VN::RegisterScan::ConfigReader` object has been created, it should be passed to the :func:`~VN::RegisterScan::loadConfiguration` method along with the :class:`~VN::Sensor` object as follows:

.. literalinclude:: ../../examples/RegisterScan/LoadConfiguration/main.cpp
   :language: c++
   :start-at: err = RegisterScan::loadConfiguration(sensor, configReader);
   :end-at: err = RegisterScan::loadConfiguration(sensor, configReader);
   :dedent: 8

.. warning:: 
    The :func:`~VN::RegisterScan::loadConfiguration` method will first issue a Restore Factory Settings command to the VectorNav unit before attempting to load the user-defined configuration settings onto the unit. This means any previously configured settings on the unit that were not captured in the configuration file will be lost and only the settings included in the configuration file will be configured on the unit. If performing a Restore Factory Settings command is not desired, the :func:`~VN::RegisterScan::setConfigurationRegisters` method should instead be used to load the user-defined settings onto the unit.

    .. code-block:: cpp

        error = RegisterScan::setConfigurationRegisters(sensor, configReader);

.. note::
    After loading the settings from a previously saved configuration file onto a VectorNav unit, the :func:`~VN::RegisterScan::loadConfiguration` method issues a Write Settings command followed by a Reset command to the unit. This ensures all configured settings are saved to the non-volatile memory of the unit and starts the unit up fresh with the configured settings.

Saving a Configuration File
^^^^^^^^^^^^^^^^^^^^^^^^^^^
In many cases, it is useful to have the current configuration of a VectorNav unit, such as to confirm that the desired settings have been applied to the sensor or to configure multiple sensors with the same configuration settings. The :func:`~VN::RegisterScan::saveConfiguration` method within the Register Scan plugin allows the user to save the current values of all configuration registers on a unit into a configuration file. To do so, a :class:`~VN::RegisterScan::ConfigWriter` object that corresponds to the desired output file type should be created. For example, to save the current configuration into an XML file, an :class:`~VN::RegisterScan::XmlConfigWriter` object should be created.

.. literalinclude:: ../../examples/RegisterScan/SaveConfiguration/main.cpp
   :language: c++
   :start-at: RegisterScan::XmlConfigWriter writer(sensor, filePath.string());
   :end-at: RegisterScan::XmlConfigWriter writer(sensor, filePath.string());
   :dedent: 12

Alternatively, to save a configuration file into a text file, an :class:`~VN::RegisterScan::AsciiConfigWriter` object should be created. 

.. literalinclude:: ../../examples/RegisterScan/SaveConfiguration/main.cpp
   :language: c++
   :start-at: RegisterScan::AsciiConfigWriter writer(filePath.string());
   :end-at: RegisterScan::AsciiConfigWriter writer(filePath.string());
   :dedent: 12

For custom configuration output handling, a :class:`~VN::RegisterScan::GenericConfigWriter` object can be implemented.

.. literalinclude:: ../../examples/RegisterScan/SaveConfiguration/main.cpp
   :language: c++
   :start-at: RegisterScan::GenericConfigWriter cout_writer(
   :end-at: });
   :dedent: 12

Once the :class:`~VN::RegisterScan::ConfigWriter` object has been created, it should be passed to the :func:`~VN::RegisterScan::saveConfiguration` method along with the :class:`~VN::Sensor` object as follows:

.. literalinclude:: ../../examples/RegisterScan/SaveConfiguration/main.cpp
   :language: c++
   :start-at: saveConfigError = RegisterScan::saveConfiguration(sensor, writer);
   :end-at: saveConfigError = RegisterScan::saveConfiguration(sensor, writer);
   :dedent: 12

The user can also optionally pass a custom filter to the :func:`~VN::RegisterScan::saveConfiguration` method to specify which registers to include or exclude when saving the configuration. For example:


.. literalinclude:: ../../examples/RegisterScan/SaveConfiguration/main.cpp
   :language: c++
   :start-at: auto configRegisters = RegisterScan::getDefaultConfigRegisters();
   :end-at: RegisterScan::SaveConfigurationFilter filter{RegisterScan::SaveConfigurationFilter::Type::Include, configRegisters};
   :dedent: 12

.. literalinclude:: ../../examples/RegisterScan/SaveConfiguration/main.cpp
   :language: c++
   :start-at: saveConfigError = RegisterScan::saveConfiguration(sensor, cout_writer, filter);
   :end-at: saveConfigError = RegisterScan::saveConfiguration(sensor, cout_writer, filter);
   :dedent: 12

Saving a Non-Default Configuration File
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
While calling the :func:`~VN::RegisterScan::saveConfiguration` method saves the current configuration settings on the VectorNav unit, the output configuration file from this method contains the values of all configuration settings on the sensor, even those that were not modified by the user and remained at the factory default values. The :func:`~VN::RegisterScan::saveNonDefaultConfiguration` method within the Register Scan plugin allows the user to save only the configuration settings on the unit that differ from the factory default values. This creates a more concise configuration file that contains only the changes made by the user, allowing the user to more easily confirm that the desired settings were applied to the unit. It is also particularly useful when transferring configurations between multiple devices, as it only transfers the necessary changes rather than the entire configuration.

.. warning::
    As part of the :func:`~VN::RegisterScan::saveNonDefaultConfiguration` method, a Restore Factory Settings command will be issued to the VectorNav unit. When using this method, it is highly recommended to monitor the progress of this call as any errors encountered could mean that the settings previously configured were not able to be reapplied onto the unit. If performing a Restore Factory Settings command is not desired, the :func:`~VN::RegisterScan::saveConfiguration` method should instead be used to save the current configuration of a VectorNav unit.

To save the current non-default configuration into an XML file, an :class:`~VN::RegisterScan::XmlConfigWriter` object should be created. 

.. literalinclude:: ../../examples/RegisterScan/SaveNonDefaultConfiguration/main.cpp
   :language: c++
   :start-at: RegisterScan::XmlConfigWriter writer(sensor, filePath.string());
   :end-at: RegisterScan::XmlConfigWriter writer(sensor, filePath.string());
   :dedent: 12

Alternatively, to save a non-default configuration file into a text file format, an :class:`~VN::RegisterScan::AsciiConfigWriter` object 
should be created. 

.. literalinclude:: ../../examples/RegisterScan/SaveNonDefaultConfiguration/main.cpp
   :language: c++
   :start-at: RegisterScan::AsciiConfigWriter writer(filePath.string());
   :end-at: RegisterScan::AsciiConfigWriter writer(filePath.string());
   :dedent: 12

For custom configuration output handling, a :class:`~VN::RegisterScan::GenericConfigWriter` object can be implemented.

.. literalinclude:: ../../examples/RegisterScan/SaveNonDefaultConfiguration/main.cpp
   :language: c++
   :start-at: RegisterScan::GenericConfigWriter cout_writer(
   :end-at: });
   :dedent: 12

Once the :class:`~VN::RegisterScan::ConfigWriter` object has been created, it should be passed to the :func:`~VN::RegisterScan::saveNonDefaultConfiguration` method along with the :class:`~VN::Sensor` object as follows:

.. literalinclude:: ../../examples/RegisterScan/SaveNonDefaultConfiguration/main.cpp
   :language: c++
   :start-at: saveConfigError = RegisterScan::saveNonDefaultConfiguration(sensor, writer);
   :end-at: saveConfigError = RegisterScan::saveNonDefaultConfiguration(sensor, writer);
   :dedent: 12

API
===

:ref:`RegisterScan<namespace_VN__RegisterScan>`
